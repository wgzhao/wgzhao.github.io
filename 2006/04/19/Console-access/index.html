
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>控制台访问 - Linux系统管理</title>
  <meta name="author" content="wgzhao">

  
  <meta name="description" content="上午去测试一个加密卡设备权限会发生变化的问题，其实这个问题和我的声卡情况相似。我一般都采用不同用户登录我的系统。
系统启动时默认会把我的声卡设备权限设置为0666,但是使用的过程中权限会发生变化，变成缺省的0600，导致普通用户不能使用声卡。
查了一些资料，得知这些设备的权限设置与文件/etc/ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://wgzhao.github.io/2006/04/19/Console-access">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Linux系统管理" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Linux系统管理</a></h1>
  
    <h2>关注Linux系统管理，运维开发以及大数据</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com.hk/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:wgzhao.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">控制台访问</h1>
    
    
      <p class="meta">
        








  


<time datetime="2006-04-19T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://wgzhao.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>上午去测试一个加密卡设备权限会发生变化的问题，其实这个问题和我的声卡情况相似。我一般都采用不同用户登录我的系统。<br/>
系统启动时默认会把我的声卡设备权限设置为0666,但是使用的过程中权限会发生变化，变成缺省的0600，导致普通用户不能使用声卡。<br/>
查了一些资料，得知这些设备的权限设置与文件<code>/etc/security/console.perms</code>文件有关，因此这里贴出我找到的有关该文件的一些说明：</p>

<!--more-->


<p><code>pam_console.so</code> 模块使用 <code>/etc/security/console.perms</code>
文件来判定系统控制台上用户的权限。<br/>
该文件的语法非常灵活；你可以编辑该文件以便 不再应用这些指示。<br/>
然而，默认文件中有一行看起来如下：<br/>
<code>tty[0-9][0-9]  * :[0-9]    .[0-9] :[0-9]</code></p>

<p>当用户登录后，他们会被连接到某种有名称的终端，要么是名称类似 :0 或 <code>mymachine.example.com:1.0</code> 的 X
服务器，要么是类似 /<code>dev/ttyS0</code> 或 <code>/dev/pts/2</code> 的设备。默认设置中，本地虚拟控制台和本地 X
服务器被定义为本地，但是如果你想把和你相邻的位于端口 <code>/dev/ttyS</code>1 上的串线终端也当作本地，你可以把上面一行改为：<br/>
<code>tty[0-9][0-9]  * :[0-9]    .[0-9] :[0-9] /dev/ttyS1</code></p>

<p><strong>使文件可从控制台访问</strong></p>

<p><code>/etc/security/console.perms</code> 文件中的某段包含以下几行：</p>

<pre><code>/dev/fd[0-1]  *     /dev/floppy/  */mnt/floppy  *
/dev/dsp  */dev/audio  */dev/midi  *     /dev/mixer  */dev/sequencer    
/dev/sound/  */dev/beep
/dev/cdrom  */dev/cdroms/  */dev/cdwriter  */mnt/cdrom  *  
</code></pre>

<p>如果有必要，你可以在这段里加入你自己编写的句子。请确定你添加的句中所指代的是正确的设备。譬如，你可以添加以下这一行：<br/>
<code>/dev/scanner/dev/usb/scanner  *</code></p>

<p>（当然，请确定 <code>/dev/scanne</code>r 的确是你的扫描仪设备，而不是你的硬盘驱动器。）</p>

<p>这是第一步。第二步是定义如何处置那些文件。在<code>/etc/security/console.perms</code> 文件的最后一段寻找与以下类似的句子：<br/>
<code>06600660 root.floppy 06000640 root 06000600 root.disk</code></p>

<p>然后，添加和以下类似的一行：<br/>
 <code>0600 0600 root</code></p>

<p>当你在控制台登录后，你就会被给予 <code>/dev/scanner</code> 设备的所有权，其权限是
0600（仅可被你读写）。当你注销后，该设备就会被根用户所有，权限依旧是 0600（现在将只能被根用户读写）。<br/>
24.6. 为其它应用程序启用控制台访问</p>

<p>如果你想使其它应用程序能被控制台用户访问，你要采取的步骤就会多一些。</p>

<p>首先， 只有 驻留在 /sbin 或 /usr/sbin
中的应用程序才能在控制台上访问，因此你想运行的程序也必须被保存在那两个目录中。满足了上面的条件后，执行下面的步骤：</p>

<ol>
<li><p>创建一个从你的应用程序（如以下例子中的 foo ）到 <code>/usr/bin/consolehelper</code> 的链接：<br/>
<code>cd /usr/bin ln -s consolehelper foo</code></p></li>
<li><p>创建文件 <code>/etc/security/console.apps/foo</code> ：  <br/>
<code>touch /etc/security/console.apps/foo</code></p></li>
<li><p>在 <code>/etc/pam.d/</code> 目录中为 foo 服务创建一个 PAM 配置文件。做到它的简单方法是使用 halt 服务的 PAM
配置文件的副本，如果你想改变行为的话，修改该文件：<br/>
<code>cp /etc/pam.d/halt /etc/pam.d/foo</code></p></li>
</ol>


<p>现在，当你运行 /usr/bin/ foo 时，它就会 调用 consolehelper ，该命令会借助
/usr/sbin/userhelper 来验证用户。要验证用户， consolehelper 会询问用户的口令（若 /etc/pam.d/
foo 是 /etc/pam.d/halt 文件的副本的话，否则，它 会仅执行在 /etc/pam.d/ foo
中的命令），然后使用根权限来运行 /usr/sbin/ foo 。</p>

<p>在 PAM 配置文件中，应用程序可以被配置使用 <code>pam_timestamp</code>
模块来记住（缓存）一次成功的尝试。当应用程序被启动并提供了正确的验证后（根口令），一个时间戳文件就会被创建。按照默认设置，成功验证会被缓存五分钟。在这段时期内，在同一会话中运行的其它配置使用
pam  _timestamp 的应用程序会自动为该用户验证 — 用户不必再输入根口令。</p>

<p>该模块被包括在 pam 软件包中。要启用这项功能， etc/pam.d/ 中的 PAM 配置文件必须包括以下几行：</p>

<pre><code>    authsufficient/lib/security/pam_timestamp.so
    sessionoptional/lib/security/pam_timestamp.so  
</code></pre>

<p>第一个以 auth 开头的行应该在任何 auth sufficient 行之后，以 session 开头的行应该在所有 session
optional 行之后。</p>

<p>如果配置使用 <code>pam_timestamp</code> 的从面板上的 「主菜单」 按钮启动的应用程序被成功地验证，
图标就会显示在面板的通知区域（若你运行的是 GNOME 桌面环境）。验证过期后（默认为五分钟），该图标就会消失。</p>

<p>用户可以通过点击图标并选择忘记验证选项来忘记缓存验证。</p>

<p>如果由于某种原因，控制台访问对你不适用，你需要给非根用户提供到系统软盘驱动器的访问，这可以通过使用 floppy
组群来达到。使用你选定的工具把用户添加到 floppy 组群就可以了。这里向你提供了一个如何使用 gpasswd 来把用户 fred 添加到
floppy 组群的例子：</p>

<pre><code>    [root@bigdog root]  # gpasswd -a fred floppy 
    Adding user fred to group floppy 
</code></pre>

<p>现在，用户 fred 就可以通过控制台访问系统的软盘驱动器了。</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">wgzhao</span></span>

      








  


<time datetime="2006-04-19T00:00:00+08:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='//categories/linuxji-zhu/'>Linux技术</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://wgzhao.github.io/2006/04/19/Console-access/" data-via="mlsx" data-counturl="http://wgzhao.github.io/2006/04/19/Console-access/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2006/04/17/iostat-output-analysis/" title="Previous Post: iostat 输出解析">&laquo; iostat 输出解析</a>
      
      
        <a class="basic-alignment right" href="/2006/04/19/sage-is-a-good-RSS-reader/" title="Next Post: sage是个不错的RSS阅读器">sage是个不错的RSS阅读器 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/01/14/block-youku-ads-cleanly/">彻底屏蔽优酷广告</a>
      </li>
    
      <li class="post">
        <a href="/2012/12/30/some-tips-for-mac-os-x/">一些Mac OS X 的使用技巧</a>
      </li>
    
      <li class="post">
        <a href="/2012/08/24/generate-random-strings-and-other-tips-on-postgresql/">生成随机字符串以及自动更新时间戳和返回最近插入的ID号</a>
      </li>
    
      <li class="post">
        <a href="/2012/08/22/some-way-to-io-statistics-on-linux/">Linux下的一些I/O统计工具</a>
      </li>
    
      <li class="post">
        <a href="/2012/08/21/explaining-the-postgresql-query-optimizer/">PostgreSQL查询优化简介</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/wgzhao">@wgzhao</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'wgzhao',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/wgzhao?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/wgzhao">My Delicious Bookmarks &raquo;</a></p>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - wgzhao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'wgzhao';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://wgzhao.github.io/2006/04/19/Console-access/';
        var disqus_url = 'http://wgzhao.github.io/2006/04/19/Console-access/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
